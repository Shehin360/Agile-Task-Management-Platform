<div class="page">
  <h1 class="title">Sprintly</h1>

  <!-- SORT TOGGLE -->
  <div class="sort-bar">
    <button class="sort-btn" [class]="'sort-active-' + sortMode()" (click)="cycleSortMode()">
      <span class="sort-icon">{{ sortLabel() }}</span>
      <span class="sort-hint">Click to change sort</span>
    </button>
  </div>

  <div class="board">
    <!-- TO DO COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'todo'"
      (dragover)="onDragOver($event, 'todo')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'todo')"
    >
      <h3 class="column-header">To Do</h3>

      <div class="column-body">
        @for (task of todoTasks(); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          [class.drop-target]="dropTargetTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
          (dragover)="onDragOverTask($event, task.id)"
        >
          <div class="task-content">
            <div class="task-header">
              <span class="task-title">{{ task.title }}</span>
              <span class="priority-badge" [class]="'priority-' + task.priority">
                {{ task.priority.toUpperCase() }}
              </span>
            </div>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            } @if (task.dueDate) {
            <span class="due-date-badge" [class]="'due-' + getDueDateStatus(task.dueDate)">
              ğŸ“… {{ formatDueDate(task.dueDate) }}
            </span>
            }
          </div>
          <div class="task-actions">
            <button class="task-btn edit-btn" (click)="startEdit(task)">âœï¸</button>
            <button class="task-btn delete-btn" (click)="deleteTask(task.id)">ğŸ—‘ï¸</button>
          </div>
        </div>
        } @empty {
        <div class="empty-state">
          <span class="empty-icon">ğŸ“‹</span>
          <span class="empty-text">No tasks yet</span>
          <span class="empty-hint">Click "+ Add Task" below to get started</span>
        </div>
        }
      </div>

      <!-- Newly added task button -->
      <button class="column-add-btn" (click)="showAddTaskModal.set(true)">+ Add Task</button>
    </div>

    <!-- IN PROGRESS COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'inprogress'"
      (dragover)="onDragOver($event, 'inprogress')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'inprogress')"
    >
      <h3 class="column-header">In Progress</h3>
      <div class="column-body">
        @for (task of inprogressTasks(); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          [class.drop-target]="dropTargetTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
          (dragover)="onDragOverTask($event, task.id)"
        >
          <div class="task-content">
            <div class="task-header">
              <span class="task-title">{{ task.title }}</span>
              <span class="priority-badge" [class]="'priority-' + task.priority">
                {{ task.priority.toUpperCase() }}
              </span>
            </div>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            } @if (task.dueDate) {
            <span class="due-date-badge" [class]="'due-' + getDueDateStatus(task.dueDate)">
              ğŸ“… {{ formatDueDate(task.dueDate) }}
            </span>
            }
          </div>
          <div class="task-actions">
            <button class="task-btn edit-btn" (click)="startEdit(task)">âœï¸</button>
            <button class="task-btn delete-btn" (click)="deleteTask(task.id)">ğŸ—‘ï¸</button>
          </div>
        </div>
        } @empty {
        <div class="empty-state">
          <span class="empty-icon">ğŸš€</span>
          <span class="empty-text">Nothing in progress</span>
          <span class="empty-hint">Drag a task here to start working on it</span>
        </div>
        }
      </div>
    </div>

    <!-- DONE COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'done'"
      (dragover)="onDragOver($event, 'done')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'done')"
    >
      <h3 class="column-header">Done</h3>
      <div class="column-body">
        @for (task of doneTasks(); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          [class.drop-target]="dropTargetTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
          (dragover)="onDragOverTask($event, task.id)"
        >
          <div class="task-content">
            <div class="task-header">
              <span class="task-title">{{ task.title }}</span>
              <span class="priority-badge" [class]="'priority-' + task.priority">
                {{ task.priority.toUpperCase() }}
              </span>
            </div>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            } @if (task.dueDate) {
            <span class="due-date-badge" [class]="'due-' + getDueDateStatus(task.dueDate)">
              ğŸ“… {{ formatDueDate(task.dueDate) }}
            </span>
            }
          </div>
          <div class="task-actions">
            <button class="task-btn edit-btn" (click)="startEdit(task)">âœï¸</button>
            <button class="task-btn delete-btn" (click)="deleteTask(task.id)">ğŸ—‘ï¸</button>
          </div>
        </div>
        } @empty {
        <div class="empty-state">
          <span class="empty-icon">âœ¨</span>
          <span class="empty-text">No completed tasks</span>
          <span class="empty-hint">Finished tasks will appear here</span>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- ADD TASK MODAL -->
  @if (showAddTaskModal()) {
  <div class="modal-backdrop" (click)="showAddTaskModal.set(false)">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Task</h2>
        <button class="modal-close" (click)="showAddTaskModal.set(false)">âœ•</button>
      </div>

      <div class="modal-body">
        <label class="modal-label">Title</label>
        <input
          class="modal-input"
          type="text"
          placeholder="Enter task title..."
          [value]="newTaskTitle()"
          (input)="newTaskTitle.set($any($event.target).value)"
          (keyup.enter)="addTask(); showAddTaskModal.set(false)"
        />

        <label class="modal-label">Description</label>
        <textarea
          class="modal-textarea"
          placeholder="Enter description (optional)..."
          [value]="newTaskDescription()"
          (input)="newTaskDescription.set($any($event.target).value)"
        ></textarea>

        <label class="modal-label">Priority</label>
        <select
          class="modal-select"
          [value]="newTaskPriority()"
          (change)="newTaskPriority.set($any($event.target).value)"
        >
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>

        <label class="modal-label">Due Date</label>
        <input
          class="modal-input modal-date"
          type="date"
          [value]="newTaskDueDate() || ''"
          (input)="newTaskDueDate.set($any($event.target).value || null)"
        />
      </div>

      <div class="modal-actions">
        <button class="modal-btn cancel" (click)="showAddTaskModal.set(false)">Cancel</button>
        <button class="modal-btn add" (click)="addTask(); showAddTaskModal.set(false)">
          Add Task
        </button>
      </div>
    </div>
  </div>
  }

  <!-- EDIT TASK MODAL -->
  @if (showEditTaskModal()) {
  <div class="modal-backdrop" (click)="cancelEdit()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Task</h2>
        <button class="modal-close" (click)="cancelEdit()">âœ•</button>
      </div>

      <div class="modal-body">
        <label class="modal-label">Title</label>
        <input
          class="modal-input"
          type="text"
          placeholder="Enter task title..."
          [value]="editingTitle()"
          (input)="editingTitle.set($any($event.target).value)"
          (keyup.enter)="saveEdit(editingTaskId()!)"
          (keyup.escape)="cancelEdit()"
        />

        <label class="modal-label">Description</label>
        <textarea
          class="modal-textarea"
          placeholder="Enter description (optional)..."
          [value]="editingDescription()"
          (input)="editingDescription.set($any($event.target).value)"
          (keyup.escape)="cancelEdit()"
        ></textarea>

        <label class="modal-label">Priority</label>
        <select
          class="modal-select"
          [value]="editingPriority()"
          (change)="editingPriority.set($any($event.target).value)"
        >
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>

        <label class="modal-label">Due Date</label>
        <input
          class="modal-input modal-date"
          type="date"
          [value]="editingDueDate() || ''"
          (input)="editingDueDate.set($any($event.target).value || null)"
        />
      </div>

      <div class="modal-actions">
        <button class="modal-btn cancel" (click)="cancelEdit()">Cancel</button>
        <button class="modal-btn add" (click)="saveEdit(editingTaskId()!)">Save Changes</button>
      </div>
    </div>
  </div>
  }
</div>
