<div class="page">
  <h1 class="title">AGILE TASK BOARD</h1>

  <div class="board">
    <!-- TO DO COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'todo'"
      (dragover)="onDragOver($event, 'todo')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'todo')"
    >
      <h3 class="column-header">To Do</h3>

      <div class="column-body">
        @for (task of getTaskByStatus('todo'); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
        >
          @if (editingTaskId() === task.id) {
          <input
            class="edit-input"
            type="text"
            placeholder="Task title..."
            [value]="editingTitle()"
            (input)="editingTitle.set($any($event.target).value)"
            (keyup.enter)="saveEdit(task.id)"
            (keyup.escape)="cancelEdit()"
          />
          <textarea
            class="edit-input description-textarea"
            placeholder="Description..."
            [value]="editingDescription()"
            (input)="editingDescription.set($any($event.target).value)"
            (keyup.escape)="cancelEdit()"
          ></textarea>
          <div class="task-actions">
            <button class="task-btn save-btn" (click)="saveEdit(task.id)">Save</button>
            <button class="task-btn cancel-btn" (click)="cancelEdit()">Cancel</button>
          </div>
          } @else {
          <div class="task-content">
            <span class="task-title">{{ task.title }}</span>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            }
          </div>
          <div class="task-actions">
            <button class="task-btn edit-btn" (click)="startEdit(task)">✎</button>
            <button class="task-btn delete-btn" (click)="deleteTask(task.id)">✕</button>
          </div>
          }
        </div>
        }
      </div>

      <!-- Newly added task button -->
      <button class="column-add-btn" (click)="showAddTaskModal.set(true)">+ Add Task</button>
    </div>

    <!-- IN PROGRESS COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'inprogress'"
      (dragover)="onDragOver($event, 'inprogress')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'inprogress')"
    >
      <h3 class="column-header">In Progress</h3>
      <div class="column-body">
        @for (task of getTaskByStatus('inprogress'); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
        >
          <div class="task-content">
            <span class="task-title">{{ task.title }}</span>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            }
          </div>
          <button class="task-btn delete-btn" (click)="deleteTask(task.id)">✕</button>
        </div>
        }
      </div>
    </div>

    <!-- DONE COLUMN -->
    <div
      class="column"
      [class.drag-over]="dragOverColumn() === 'done'"
      (dragover)="onDragOver($event, 'done')"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event, 'done')"
    >
      <h3 class="column-header">Done</h3>
      <div class="column-body">
        @for (task of getTaskByStatus('done'); track task.id) {
        <div
          class="task"
          @taskAnim
          draggable="true"
          [class.dragging]="draggedTaskId() === task.id"
          (dragstart)="onDragStart($event, task.id)"
          (dragend)="onDragEnd()"
        >
          <div class="task-content">
            <span class="task-title">{{ task.title }}</span>
            @if (task.description) {
            <span class="task-description">{{ task.description }}</span>
            }
          </div>
          <button class="task-btn delete-btn" (click)="deleteTask(task.id)">✕</button>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- MODAL -->
  @if (showAddTaskModal()) {
  <div class="modal-backdrop" (click)="showAddTaskModal.set(false)">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Task</h2>
        <button class="modal-close" (click)="showAddTaskModal.set(false)">✕</button>
      </div>

      <div class="modal-body">
        <label class="modal-label">Title</label>
        <input
          class="modal-input"
          type="text"
          placeholder="Enter task title..."
          [value]="newTaskTitle()"
          (input)="newTaskTitle.set($any($event.target).value)"
          (keyup.enter)="addTask(); showAddTaskModal.set(false)"
        />

        <label class="modal-label">Description</label>
        <textarea
          class="modal-textarea"
          placeholder="Enter description (optional)..."
          [value]="newTaskDescription()"
          (input)="newTaskDescription.set($any($event.target).value)"
        ></textarea>
      </div>

      <div class="modal-actions">
        <button class="modal-btn cancel" (click)="showAddTaskModal.set(false)">Cancel</button>
        <button class="modal-btn add" (click)="addTask(); showAddTaskModal.set(false)">
          Add Task
        </button>
      </div>
    </div>
  </div>
  }
</div>
